services:
  docs-redirect:
    image: nginx:alpine
    volumes:
      - ./data/docs-redirect/default.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - 80:80
    restart: always
  consensus-full:
    image: ghcr.io/celestiaorg/celestia-app:v3.0.2
    volumes:
      - ./data/consensus-full:/home/celestia
    command:
      - start
    restart: always
  da-bridge:
    image: ghcr.io/celestiaorg/celestia-node:e11cd71
    volumes:
      - ./data/da-bridge:/home/celestia
    environment:
      - NODE_TYPE=bridge
      - P2P_NETWORK=mocha-4
    ports:
      - 2121:2121
    command:
      - celestia
      - bridge
      - start
      - --core.ip=consensus-full-mocha-4.celestia-mocha.com # TODO: point to local consensus
      - --p2p.network=mocha-4
      - --archival
      - --rpc.skip-auth # TODO: remove
    restart: always
  da-light:
    image: ghcr.io/celestiaorg/celestia-node:e11cd71
    volumes:
      - ./data/da-light:/home/celestia
    environment:
      - NODE_TYPE=light
      - P2P_NETWORK=mocha-4
    command:
      - celestia
      - light
      - start
      - --core.ip=consensus-full-mocha-4.celestia-mocha.com # TODO: point to local consensus
      - --p2p.network=mocha-4
      - --rpc.skip-auth # TODO: remove
    restart: always
  #lumina-light
  redis:
    image: redis:latest
    restart: always
    volumes:
      - ./data/redis:/data
    command: ["redis-server", "--save", "60", "1", "--loglevel", "warning"]
  prism-prover:
    image: ghcr.io/deltadevsde/prism:pr-205
    volumes:
      - ./data/prism-prover:/root/.prism
    restart: always
    # entrypoint: ["sleep", "infinity"]
    environment:
      - SYMMETRIC_KEY=3c4a987867c9fa3cf8f5309b236cde63100e9fcfbe8ac453a2eeddd0b3251a08
    command:
      - prover
      - --celestia-client=ws://da-bridge:26658
      - --celestia-start-height=4180975
      - --keystore-type=file
      - --redis-client=redis://redis:6379
      - --operation-namespace-id=000000000000000000000000000000000000707269736d5350456f70
      - --snark-namespace-id=000000000000000000000000000000000000707269736d535045736e
      - --port=41997
  prism-full:
    image: ghcr.io/deltadevsde/prism:pr-205
    volumes:
      - ./data/prism-full:/root/.prism
    restart: always
    ports:
      - 41997:41997
    command:
      - full-node
      - --celestia-client=ws://da-bridge:26658
      - --celestia-start-height=4180975
      - --redis-client=redis://redis:6379
      - --verifying-key-algorithm=ed25519
      - --verifying-key=L2ilppK59Kq3aAMB/wpxdVGaI53DHPMdY6fcRodyFaA=
      - --operation-namespace-id=000000000000000000000000000000000000707269736d5350456f70
      - --snark-namespace-id=000000000000000000000000000000000000707269736d535045736e
      - --port=41997
  prism-light:
    image: ghcr.io/deltadevsde/prism:pr-205
    volumes:
      - ./data/prism-light:/root/.prism
    restart: always
    command:
      - light-client
      - --celestia-client=ws://da-light:26658
      - --celestia-start-height=4180975
      - --verifying-key=L2ilppK59Kq3aAMB/wpxdVGaI53DHPMdY6fcRodyFaA=
      - --operation-namespace-id=000000000000000000000000000000000000707269736d5350456f70
      - --snark-namespace-id=000000000000000000000000000000000000707269736d535045736e
      - --port=41997

# /dns/da-bridge/tcp/2121/p2p/12D3KooWDek5ZWNVpgKBXcBn7dajueYhLDm4SubTgwJj6MKKyudq


# curl --max-time 0.5 -s -X POST -H "Content-type: application/json" -H "Accept: application/json" -d '{"id":1,"jsonrpc":"2.0","method":"header.Subscribe","params":[]}' "http://localhost:26658"
# curl --max-time 0.5 -s -X POST -H "Content-type: application/json" -H "Accept: application/json" -H "Authorization: Bearer $AUTH_TOKEN" -d '{"id":1,"jsonrpc":"2.0","method":"header.Subscribe","params":[]}' "http://localhost:26658"
